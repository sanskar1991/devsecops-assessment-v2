apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-init-scripts
  namespace: devsecops
data:
  app-user.js: |
    // Creates an application-scoped user with readWrite on the app DB.
    // Values come from environment variables.

    const dbName   = process.env.APP_DB_NAME     || 'devsecops';
    const appUser  = process.env.APP_DB_USERNAME || 'app_user';
    const appPass  = process.env.APP_DB_PASSWORD || 'PaSS_wOrd!';

    db.getSiblingDB(dbName).createUser({
      user: appUser,
      pwd:  appPass,
      roles: [
        { role: 'readWrite', db: dbName }
      ]
    });

    print(`Created user ${appUser} with readWrite on ${dbName}`);
